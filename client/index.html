<!DOCTYPE html>
<html>
  <head>
    <title>wren</title>
    <script src="../bower_components/jquery/jquery.min.js"></script>
    <script src="../bower_components/moment/min/moment.min.js"></script>
    <script src="../bower_components/Chart.js/Chart.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <div id="container">
      <div class="logo">wren</div>
      <div class="chart">
        <header>MtGox</header>
        <canvas id="mtGox" width="400" height="400"></canvas>
      </div>
      <div class="chart">
        <header>Twitter Sentiment</header>
        <canvas id="tweets" width="400" height="400"></canvas>
      </div>
      <button class="refresh">Refresh Data</button>
    </div>
    <script>
      $(document).ready(function() {
        var startingTime = new Date() - (1800000 * 12);
        var timeDeltas = [];

        // fake data
        var exchangeData = {
          labels: [],
          datasets: [
            // {
            //   fillColor: "rgba(220, 220, 220, 0.5)",
            //   strokeColor: "rgba(220, 220, 220, 1)",
            //   pointColor: "rgba(220, 220, 220, 1)",
            //   pointStrokeColor : "#fff",
            //   data : []
            // }/*,
            {
              fillColor : "rgba(151,187,205,0.5)",
              strokeColor : "rgba(151,187,205,1)",
              pointColor : "rgba(151,187,205,1)",
              pointStrokeColor : "#fff",
              data : [28,48,40,19,96,27,100]
            }
          ]
        };

        var tweetData = {
          labels: [],
          datasets: [
            {
              fillColor: "rgba(220, 220, 220, 0.5)",
              strokeColor: "rgba(220, 220, 220, 1)",
              pointColor: "rgba(220, 220, 220, 1)",
              pointStrokeColor : "#fff",
              data : []
            }
            // {
            //   fillColor : "rgba(151,187,205,0.5)",
            //   strokeColor : "rgba(151,187,205,1)",
            //   pointColor : "rgba(151,187,205,1)",
            //   pointStrokeColor : "#fff",
            //   data : [28,48,40,19,96,27,100]
            // }
          ]
        };

        for (var i = 0; i < 12; i++) {
          timeDeltas[i] = startingTime;
          exchangeData.labels.push(moment(timeDeltas[i]).format('HH:mm'));
          tweetData.labels.push(moment(timeDeltas[i]).format('HH:mm'));
          startingTime += 1800000;
        }

        // clicking refresh button sends GET request to '/data'
        $('button.refresh').click(function() {
          $.get('http://127.0.0.1:8080/data', moment(timeDeltas[0]).format('YYYY-MM-DD HH:mm:ss'),function(recvd){
            // reset pre-existing data
            exchangeData.datasets[0].data = [];
            tweetData.datasets[0].data = [];
            for(var i = 0; i < 12; i++){
              if(recvd[i] !== null) {
                exchangeData.datasets[0].data[i] = recvd.mtgox.value[i];
                tweetData.datasets[0].data[i] = recvd.tweets.sentiment[i];
              }
            }
            var exchanges = new Chart(exchangeCtx).Line(exchangeData, {scaleFontColor: '#ddd', scaleLabel: "<%= '$' + value %>"});
            // display tweet sentiment chart
            var tweets = new Chart(tweetCtx).Line(tweetData, {scaleFontColor: '#ddd'});
          });
        });

        //Get the context of the canvas element we want to select
        var exchangeCtx = document.getElementById("mtGox").getContext("2d");
        var tweetCtx = document.getElementById("tweets").getContext("2d");
      });
    </script>
  </body>
</html>