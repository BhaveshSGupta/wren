<!DOCTYPE html>
<html>
  <head>
    <title>wren</title>
    <script src="../bower_components/jquery/jquery.min.js"></script>
    <script src="../bower_components/moment/min/moment.min.js"></script>
    <script src="../bower_components/Chart.js/Chart.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <div id="container">
      <h1>wren <button class="refresh">Refresh Data</button></h1>
      <canvas id="myChart" width="400" height="400"></canvas>

      <!-- <table>
        <thead>
          <tr class='time'>
            <td>Time</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </thead>
          <tr class='mtgox'>
            <td>MtGox</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class='sentiment'>
            <td>Sentiment</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class='total'>
            <td>Total</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        <tbody>
        </tbody>
      </table> -->
    </div>
  </body>
  <script>
    $(document).ready(function() {
      var startingTime = new Date() - (1800000 * 12);
      var timeDeltas = [];
      for(var i = 0; i < 12; i++) {
        timeDeltas.push(moment(startingTime).format('HH:mm'));
        startingTime += 1800000;
      }

      $('tr.time td').each(function(index, value) {
        if(index){
          $(this).html(moment(timeDelta).format('HH:mm'));
          timeDelta += 1800000;
        }
      });

      // clicking refresh button sends GET request to '/data'
      $('button.refresh').click(function() {
        $.get('http://127.0.0.1:8080/data', moment(startingTime).format('YYYY-MM-DD HH:mm:ss'),function(recvd){
          //data.datasets[0].data.push(recvd);
          myNewChart = new Chart(ctx).Line(data, {scaleFontColor: '#ddd'});
        });
      });

      // fake data
      var data = {
        labels: timeDeltas,
        datasets: [
          {
            fillColor: "rgba(220, 220, 220, 0.5)",
            strokeColor: "rgba(220, 220, 220, 1)",
            pointColor: "rgba(220, 220, 220, 1)",
            pointStrokeColor : "#fff",
            data : []
          }/*,
          {
            fillColor : "rgba(151,187,205,0.5)",
            strokeColor : "rgba(151,187,205,1)",
            pointColor : "rgba(151,187,205,1)",
            pointStrokeColor : "#fff",
            data : [28,48,40,19,96,27,100]
          }*/
        ]
      };

      // get chart context
      //Get the context of the canvas element we want to select
      var ctx = document.getElementById("myChart").getContext("2d");
      var myNewChart = new Chart(ctx).Line(data, {scaleFontColor: '#ddd'});


    });
  </script>
</html>