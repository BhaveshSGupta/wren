<!DOCTYPE html>
<html>
  <head>
    <title>wren</title>
    <script src="../bower_components/jquery/jquery.min.js"></script>
    <script src="../bower_components/moment/min/moment.min.js"></script>
    <script src="../bower_components/Chart.js/Chart.min.js"></script>
    <script src="../bower_components/highcharts/highcharts.js"></script>
    <script src="../bower_components/underscore/underscore-min.js"></script>
    <script src="../bower_components/backbone/backbone-min.js"></script>

    <!-- Backbone files -->
    <script src="app/models/App.js"></script>

    <script src="app/views/AppView.js"></script>
    
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <script>
      $(document).ready(function() {
        // Initialize Backbone App here
        // set up model objects
        var app = new App({});

        // build a view for the top level of the whole app
        var appView = new AppView({model: app});

        // Clicking refresh button sends GET request to '/data'
        $('button.refresh').click(function() {
          var startingTime = new Date() - (1800000 * 12);
          var timeDeltas = [];

          // create labels for chart
          for (var i = 0; i < 12; i++) {
            timeDeltas[i] = startingTime;
            startingTime += 1800000;
          }

          // $.get('http://little-wren.herokuapp.com/data', moment(timeDeltas[0]).format('YYYY-MM-DD HH:mm:ss'),function(data){
          $.get('http://127.0.0.1:5000/data', moment(timeDeltas[0]).format('YYYY-MM-DD HH:mm:ss'),function(data){
            // add data to chart
            var values = {mtgox: {value: []}, twitter: {sentiment: []}}
            for(var i = 0; i < 12; i++){
              values.mtgox.value.push(data.mtgox.value[i]);
              values.twitter.sentiment.push(data.tweets.sentiment[i]);
            }

            console.log('mtgox:', values.mtgox.value);
            console.log('twitter:', values.twitter.sentiment);

            $('#container').highcharts({
              credits: {
                enabled: false
              },
              chart: {
                  type: 'spline'
              },
              title: {
                  text: 'MtGox vs Twitter Sentiment'
              },
              series: [{
                  name: 'MtGox',
                  data: values.mtgox.value,
                  yAxis: 0
              }, {
                  name: 'Twitter',
                  data: values.twitter.sentiment,
                  yAxis: 1
              }],
              yAxis: [{title: "MtGox"},{title:"Twitter Sentiment", opposite: true}],
              plotOptions: {
                area: {
                    marker: {
                        enabled: false,
                        symbol: 'circle',
                        radius: 2,
                        states: {
                            hover: {
                                enabled: true
                            }
                        }
                    }
                }
              }
            });
          });
        });
        /**
         * Gray theme for Highcharts JS
         * @author Torstein HÃ¸nsi
         */

        Highcharts.theme = {
           colors: ["#DDDF0D", "#7798BF", "#55BF3B", "#DF5353", "#aaeeee", "#ff0066", "#eeaaee",
              "#55BF3B", "#DF5353", "#7798BF", "#aaeeee"],
           chart: {
              backgroundColor: {
                 linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                 stops: [
                    [0, 'rgb(96, 96, 96)'],
                    [1, 'rgb(16, 16, 16)']
                 ]
              },
              borderWidth: 0,
              borderRadius: 15,
              plotBackgroundColor: null,
              plotShadow: false,
              plotBorderWidth: 0
           },
           title: {
              style: {
                 color: '#FFF',
                 font: '16px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
              }
           },
           subtitle: {
              style: {
                 color: '#DDD',
                 font: '12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
              }
           },
           xAxis: {
              gridLineWidth: 0,
              lineColor: '#999',
              tickColor: '#999',
              labels: {
                 style: {
                    color: '#999',
                    fontWeight: 'bold'
                 }
              },
              title: {
                 style: {
                    color: '#AAA',
                    font: 'bold 12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
                 }
              }
           },
           yAxis: {
              alternateGridColor: null,
              minorTickInterval: null,
              gridLineColor: 'rgba(255, 255, 255, .1)',
              minorGridLineColor: 'rgba(255,255,255,0.07)',
              lineWidth: 0,
              tickWidth: 0,
              labels: {
                 style: {
                    color: '#999',
                    fontWeight: 'bold'
                 }
              },
              title: {
                 style: {
                    color: '#AAA',
                    font: 'bold 12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
                 }
              }
           },
           legend: {
              itemStyle: {
                 color: '#CCC'
              },
              itemHoverStyle: {
                 color: '#FFF'
              },
              itemHiddenStyle: {
                 color: '#333'
              }
           },
           labels: {
              style: {
                 color: '#CCC'
              }
           },
           tooltip: {
              backgroundColor: {
                 linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                 stops: [
                    [0, 'rgba(96, 96, 96, .8)'],
                    [1, 'rgba(16, 16, 16, .8)']
                 ]
              },
              borderWidth: 0,
              style: {
                 color: '#FFF'
              }
           },


           plotOptions: {
              series: {
                 shadow: true
              },
              line: {
                 dataLabels: {
                    color: '#CCC'
                 },
                 marker: {
                    lineColor: '#333'
                 }
              },
              spline: {
                 marker: {
                    lineColor: '#333'
                 }
              },
              scatter: {
                 marker: {
                    lineColor: '#333'
                 }
              },
              candlestick: {
                 lineColor: 'white'
              }
           },

           toolbar: {
              itemStyle: {
                 color: '#CCC'
              }
           },

           navigation: {
              buttonOptions: {
                 symbolStroke: '#DDDDDD',
                 hoverSymbolStroke: '#FFFFFF',
                 theme: {
                    fill: {
                       linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                       stops: [
                          [0.4, '#606060'],
                          [0.6, '#333333']
                       ]
                    },
                    stroke: '#000000'
                 }
              }
           },

           // scroll charts
           rangeSelector: {
              buttonTheme: {
                 fill: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                       [0.4, '#888'],
                       [0.6, '#555']
                    ]
                 },
                 stroke: '#000000',
                 style: {
                    color: '#CCC',
                    fontWeight: 'bold'
                 },
                 states: {
                    hover: {
                       fill: {
                          linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                          stops: [
                             [0.4, '#BBB'],
                             [0.6, '#888']
                          ]
                       },
                       stroke: '#000000',
                       style: {
                          color: 'white'
                       }
                    },
                    select: {
                       fill: {
                          linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                          stops: [
                             [0.1, '#000'],
                             [0.3, '#333']
                          ]
                       },
                       stroke: '#000000',
                       style: {
                          color: 'yellow'
                       }
                    }
                 }
              },
              inputStyle: {
                 backgroundColor: '#333',
                 color: 'silver'
              },
              labelStyle: {
                 color: 'silver'
              }
           },

           navigator: {
              handles: {
                 backgroundColor: '#666',
                 borderColor: '#AAA'
              },
              outlineColor: '#CCC',
              maskFill: 'rgba(16, 16, 16, 0.5)',
              series: {
                 color: '#7798BF',
                 lineColor: '#A6C7ED'
              }
           },

           scrollbar: {
              barBackgroundColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                       [0.4, '#888'],
                       [0.6, '#555']
                    ]
                 },
              barBorderColor: '#CCC',
              buttonArrowColor: '#CCC',
              buttonBackgroundColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                       [0.4, '#888'],
                       [0.6, '#555']
                    ]
                 },
              buttonBorderColor: '#CCC',
              rifleColor: '#FFF',
              trackBackgroundColor: {
                 linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                 stops: [
                    [0, '#000'],
                    [1, '#333']
                 ]
              },
              trackBorderColor: '#666'
           },

           // special colors for some of the demo examples
           legendBackgroundColor: 'rgba(48, 48, 48, 0.8)',
           legendBackgroundColorSolid: 'rgb(70, 70, 70)',
           dataLabelsColor: '#444',
           textColor: '#E0E0E0',
           maskColor: 'rgba(255,255,255,0.3)'
        };

        // Apply the theme
        var highchartsOptions = Highcharts.setOptions(Highcharts.theme);
      });
    </script>
  </body>
</html>